---
title: "STAT 4620 Final Project"
output: pdf_document
date: "2025-12-14"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Import Libraries
library(tidyverse)
library(rpart)
library(rpart.plot)
library(caret)
library(pROC)
library(class)
```

```{r}
# Setup and Import Data
set.seed(4620)
train <- read.csv("data/train.csv")
test <- read.csv("data/test.csv")
```

# EDA

```{r}

```

# Model Analysis

## Classification/Regression Tree
```{r}
# Setup Classification Data
train_class <- train
test_class <- test

train_class$Bankrupt. <- factor(train_class$Bankrupt.)
test_class$Bankrupt. <- factor(test_class$Bankrupt.)

predictor_cols <- setdiff(colnames(train_class), "Bankrupt.")
```

```{r}
# Apply CART Model
cart_full <- rpart(
  formula = as.formula(paste("Bankrupt. ~", paste(predictor_cols, collapse = " + "))),
  data = train_class,
  method = "class",
  cp = 0.0001,
  minsplit = 5
)
```

```{r}
# Examine Output
printcp(cart_full)
plotcp(cart_full)
```

```{r}
# Find Optimal Value For Pruning
cptable <- cart_full$cptable
min_row <- which.min(cptable[,"xerror"])

xerr_min <- cptable[min_row,"xerror"]
xerr_SE  <- cptable[min_row,"xstd"]

threshold <- xerr_min + xerr_SE
opt_row <- which(cptable[,"xerror"] <= threshold)[1]
opt_cp <- cptable[opt_row,"CP"]
```

```{r}
# Prune Tree
cart_pruned <- prune(cart_full, cp = opt_cp)

cart_pruned$variable.importance
```

```{r}
# Plot Updated Tree
rpart.plot(
  cart_pruned,
  type = 2,
  fallen.leaves = TRUE,
  extra = 104,
  main = "Pruned CART Tree"
)
```

## KNN
```{r}
# Setup Classification Data
train_knn <- train
test_knn <- test

train_knn$Bankrupt. <- factor(train_knn$Bankrupt.)
test_knn$Bankrupt. <- factor(test_knn$Bankrupt.)

predictor_cols <- setdiff(colnames(train), c("Bankrupt.", "Unnamed..0"))
```

```{r}
# Standardize Predictors
preproc <- preProcess(train[, predictor_cols], method = c("center", "scale"))

train_scaled <- predict(preproc, train_knn[, predictor_cols])
test_scaled <- predict(preproc, test_knn[, predictor_cols])
```

```{r}
# Find Best K Value
K_values <- seq(1, 51, by = 2)
acc_results <- c()

for (k in K_values) {
  knn_pred <- knn(
    train = train_scaled,
    test = test_scaled,
    cl = train_knn$Bankrupt.,
    k = k,
    prob = TRUE
  )
  
  acc <- mean(knn_pred == test_knn$Bankrupt.)
  acc_results <- c(acc_results, acc)
}

best_k <- K_values[which.max(acc_results)]
best_k
```

```{r}
# Fit KNN Model and 
knn_pred <- knn(
  train = train_scaled,
  test  = test_scaled,
  cl = train_knn$Bankrupt.,
  k = best_k,
  prob = TRUE
)

conf_mat <- confusionMatrix(knn_pred, test_knn$Bankrupt.)
conf_mat

accuracy <- conf_mat$overall["Accuracy"]
sensitivity <- conf_mat$byClass["Sensitivity"]
specificity <- conf_mat$byClass["Specificity"]

accuracy
sensitivity
specificity
```

